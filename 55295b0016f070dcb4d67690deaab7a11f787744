{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "908479ce_b2f2e1d1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1115935
      },
      "writtenOn": "2024-02-23T18:56:03Z",
      "side": 1,
      "message": "PTAL. (I know I\u0027ll also need a bunch of OWNERS.)\n\nHappy to iterate on things, but for today I\u0027m running out of time, so I\u0027m uploading what I have.",
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4b9beb79_f1b8a723",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1177599
      },
      "writtenOn": "2024-02-26T14:42:32Z",
      "side": 1,
      "message": "Most of the changes don\u0027t seem to make the code any better. If we can work with `V8_ASSUME` at some places to silence warnings that would be great, otherwise I am not convinced that we should add code just to work around false positive compiler warnings. What if any of this introduces a bug which can only be found in a GCC-build?",
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "871e3d7d_53d38705",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1115935
      },
      "writtenOn": "2024-02-27T11:27:20Z",
      "side": 1,
      "message": "Well, we do (sort-of) support GCC. The GCC bot on our waterfall is currently on GCC-9, so that\u0027s the only version we have test coverage for, and while there is no urgency to support newer versions, we\u0027ll have to do that eventually; and every now and then it would be convenient for local investigations if builds with GCC versions we have on our workstations didn\u0027t immediately fail.\n(That said, I agree that these aren\u0027t code improvements. They\u0027re workarounds for compiler limitations. In a perfect world they wouldn\u0027t be necessary, but we have to work with what we have.)",
      "parentUuid": "4b9beb79_f1b8a723",
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ea18e0f0_c101cf7b",
        "filename": "src/compiler/turboshaft/types.h",
        "patchSetId": 1
      },
      "lineNbr": 394,
      "author": {
        "id": 1115935
      },
      "writtenOn": "2024-02-23T18:56:03Z",
      "side": 1,
      "message": "For whatever reason, `DCHECK_NOT_NULL(zone)` was not enough here. (It did the trick in `zone-list.h`.)",
      "range": {
        "startLine": 394,
        "startChar": 6,
        "endLine": 394,
        "endChar": 50
      },
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b39c85d9_d2d205c8",
        "filename": "src/compiler/turboshaft/types.h",
        "patchSetId": 1
      },
      "lineNbr": 394,
      "author": {
        "id": 1177599
      },
      "writtenOn": "2024-02-26T14:42:32Z",
      "side": 1,
      "message": "Would it work to turn some `DCHECK`s into `V8_ASSUME`s to make the compiler aware of the implication?\nOr just additionally add a `V8_ASSUME(zone !\u003d nullptr);` here.",
      "parentUuid": "ea18e0f0_c101cf7b",
      "range": {
        "startLine": 394,
        "startChar": 6,
        "endLine": 394,
        "endChar": 50
      },
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4ef13317_e6662c68",
        "filename": "src/deoptimizer/frame-description.h",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1115935
      },
      "writtenOn": "2024-02-23T18:56:03Z",
      "side": 1,
      "message": "Followed the example above (line 29ff).",
      "range": {
        "startLine": 44,
        "startChar": 4,
        "endLine": 44,
        "endChar": 73
      },
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fdf7e56d_0fad2e07",
        "filename": "src/deoptimizer/frame-description.h",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1177599
      },
      "writtenOn": "2024-02-26T14:42:32Z",
      "side": 1,
      "message": "Another candidate for `static constexpr unsigned kMaxNumRegs \u003d arraysize(double_registers_); V8_ASSUME(n \u003c kMaxNumRegs);`.",
      "parentUuid": "4ef13317_e6662c68",
      "range": {
        "startLine": 44,
        "startChar": 4,
        "endLine": 44,
        "endChar": 73
      },
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "24863a85_c3f153c0",
        "filename": "src/interpreter/bytecodes.h",
        "patchSetId": 1
      },
      "lineNbr": 855,
      "author": {
        "id": 1115935
      },
      "writtenOn": "2024-02-23T18:56:03Z",
      "side": 1,
      "message": "I could move this to some global header file and use it everywhere... or inline it here instead of having a macro. I don\u0027t feel strongly about it either way.",
      "range": {
        "startLine": 855,
        "startChar": 0,
        "endLine": 855,
        "endChar": 21
      },
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2b18bc58_4eaa7cee",
        "filename": "src/interpreter/bytecodes.h",
        "patchSetId": 1
      },
      "lineNbr": 855,
      "author": {
        "id": 1177599
      },
      "writtenOn": "2024-02-26T14:42:32Z",
      "side": 1,
      "message": "This looks pretty identical to `V8_ASSUME`, which should use `__builtin_unreachable()`, and compile to `if (!(condition)) __ builin_unreachable();`. Can you check if this is the case for you locally?",
      "parentUuid": "24863a85_c3f153c0",
      "range": {
        "startLine": 855,
        "startChar": 0,
        "endLine": 855,
        "endChar": 21
      },
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "41556742_9e8a5a59",
        "filename": "src/interpreter/bytecodes.h",
        "patchSetId": 1
      },
      "lineNbr": 855,
      "author": {
        "id": 1115935
      },
      "writtenOn": "2024-02-27T11:27:20Z",
      "side": 1,
      "message": "I think the problem is this part:\n```\n#ifdef DEBUG\n// In debug mode, check assumptions instead of actually adding annotations.\n# define V8_ASSUME DCHECK\n```\nSo at least optdebug builds (which I was testing) don\u0027t benefit from `V8_ASSUME` in this regard.\nAnd we can\u0027t easily mark `DCHECK` as `noreturn` or similar because it might actually return:\n```\n  if (v8::base::g_abort_mode \u003d\u003d v8::base::AbortMode::kSoft) {\n    // In this mode, DCHECK failures don\u0027t lead to process termination.\n```",
      "parentUuid": "2b18bc58_4eaa7cee",
      "range": {
        "startLine": 855,
        "startChar": 0,
        "endLine": 855,
        "endChar": 21
      },
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "acfbcf42_cdbca6f2",
        "filename": "src/wasm/function-compiler.cc",
        "patchSetId": 1
      },
      "lineNbr": 111,
      "author": {
        "id": 1177599
      },
      "writtenOn": "2024-02-26T14:42:32Z",
      "side": 1,
      "message": "`result` will be overwritten in both switch cases below, so setting this field here seems pointless.\n\nBoth Liftoff and TurboFan seem to set it already (in `liftoff-compiler.cc` / `pipeline.cc`). If it\u0027s missing somewhere, we should add it there.",
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "46a72f58_965cfbaf",
        "filename": "src/wasm/function-compiler.cc",
        "patchSetId": 1
      },
      "lineNbr": 111,
      "author": {
        "id": 1115935
      },
      "writtenOn": "2024-02-27T11:27:20Z",
      "side": 1,
      "message": "I agree, but GCC doesn\u0027t:\n```\n../../src/wasm/function-compiler.cc: In member function ‘v8::internal::wasm::WasmCompilationResult v8::internal::wasm::WasmCompilationUnit::ExecuteFunctionCompilation(v8::internal::wasm::CompilationEnv*, const v8::internal::wasm::WireBytesStorage*, v8::internal::Counters*, v8::internal::wasm::WasmFeatures*)’:\n../../src/wasm/function-compiler.cc:110:25: error: ‘*(signed char*)((char*)\u0026result + offsetof(v8::internal::wasm::WasmCompilationResult, v8::internal::wasm::WasmCompilationResult::result_tier))’ is used uninitialized [-Werror\u003duninitialized]\n  110 |   WasmCompilationResult result;\n      |                         ^~~~~~\n```\nAn alternative (and perhaps cleaner) fix is to provide an initializer in the `WasmCompilationResult` struct, as we do for all its other fields.",
      "parentUuid": "acfbcf42_cdbca6f2",
      "revId": "55295b0016f070dcb4d67690deaab7a11f787744",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}